---
title: "Merging datasets"
format: html
editor: source
---

```{r}
# libraries
library(tidyverse)
library(janitor)
library(lubridate)
library(sf)
```

```{r}
# use cleaned data
ice <- read_csv('data/ice_encounters_cleaned.csv')

#nat_cit <- read_csv('nat_cit_cleaned.csv')
```

```{r}
# load in shapefiles
#county_shapes <- st_read("counties_shapes/USA Census Counties.shp")
#aor_shapes <- st_read("ICE_AORs_shapes/ICE AORs.shp")

aor_shapes <- st_read("data/aor_merged_shapes/aor_merged.shp")
```

```{r}
#county_shapes<- clean_names(county_shapes)
#aor_shapes<- clean_names(aor_shapes)

aor_shapes <- clean_names(aor_shapes)
```

## Some more cleaning to better fit the shapefile

```{r}
unique(ice$aor)
length(unique(ice$aor))
```
```{r}
unique(aor_shapes$aor)
length(unique(aor_shapes$aor))
```
```{r}
setdiff(ice$aor, aor_shapes$aor)
setdiff(aor_shapes$aor, ice$aor)
```

Rename AOR names to match shapefile
```{r}

aor_shapes <- aor_shapes |>
  mutate(aor = ifelse(aor == "Harlingeen", "Harlingen", aor)) |>
  select(-layer)

```

```{r}
setdiff(ice$aor, aor_shapes$aor)
setdiff(aor_shapes$aor, ice$aor)
```


```{r}
aor_clean <- aor_shapes |>
  mutate(geometry = st_make_valid(geometry))  # fixes invalid geometries
```

```{r}
st_write(aor_clean, "/Users/gabriellelow/Downloads/ICE mapping project/aors_counties.shp", driver="ESRI Shapefile")
```


